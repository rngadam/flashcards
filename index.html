<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flashcards</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <div id="top-bar">
      <div id="top-notification" class="hidden"></div>
      <h1 id="config-title"></h1>
      <div class="desktop-only-buttons">
        <button id="history-button">üìú</button>
        <button id="settings-button">‚öôÔ∏è</button>
        <button id="help-button">?</button>
        <button id="fullscreen-button">‚õ∂</button>
      </div>
      <button id="hamburger-menu" class="mobile-only-button">‚ò∞</button>
    </div>

    <div id="mobile-menu-overlay" class="modal-overlay hidden">
        <div id="mobile-menu-panel">
            <button id="mobile-history-button">üìú History</button>
            <button id="mobile-settings-button">‚öôÔ∏è Settings</button>
            <button id="mobile-help-button">? Help</button>
            <button id="mobile-fullscreen-button">‚õ∂ Fullscreen</button>
            <button id="close-mobile-menu-button">Close</button>
        </div>
    </div>

    <div id="help-modal" class="modal-overlay hidden">
        <div id="help-panel">
            <button id="close-help-button">X</button>
            <h2>How to Use Flashcards</h2>
            <p>Follow these steps to get started:</p>
            <ol>
                <li><strong>Load Data:</strong>
                    <ul>
                        <li>Go to <strong>Settings (‚öôÔ∏è)</strong>.</li>
                        <li>Find the "Data Source URL" field.</li>
                        <li>Paste the URL of your TSV or CSV file (e.g., a published Google Sheet).</li>
                        <li>Click <strong>Load</strong>. The app will fetch and parse your data.</li>
                    </ul>
                </li>
                <li><strong>Configure Columns:</strong>
                    <ul>
                        <li>Once data is loaded, the app will show the columns it found.</li>
                        <li>In the "Column Roles" section, assign roles like 'Target Language' and 'Base Language' to your columns.</li>
                        <li>Click <strong>Auto-Configure Skill Settings</strong> to automatically set up practice modes based on your roles.</li>
                    </ul>
                </li>
                <li><strong>Select Skills:</strong>
                    <ul>
                        <li>Go to the <strong>Skills</strong> tab.</li>
                        <li>Check the boxes for the skills you want to practice (e.g., Reading, Writing).</li>
                        <li>You can further customize which columns appear on the front and back of the card for each skill.</li>
                    </ul>
                </li>
                <li><strong>Name and Save:</strong>
                    <ul>
                        <li>Give your configuration a name (e.g., "Spanish Chapter 1").</li>
                        <li>Click <strong>Save Configuration</strong>.</li>
                    </ul>
                </li>
                <li><strong>Start Practicing:</strong>
                    <ul>
                        <li>Close the settings panel.</li>
                        <li>Use the buttons or keyboard shortcuts (displayed on desktop) to navigate, flip cards, and mark them as known or unknown.</li>
                        <li>The app uses a spaced repetition system to show you cards at optimal intervals for learning.</li>
                    </ul>
                </li>
            </ol>
        </div>
    </div>

    <div id="history-modal" class="modal-overlay hidden">
      <div id="history-panel">
        <button id="close-history-button">X</button>
        <h2>History</h2>
        <div id="history-table-container"></div>
      </div>
    </div>

    <div id="settings-modal" class="modal-overlay hidden">
      <div id="settings">
        <button id="close-settings-button">X</button>
        <h2>Settings</h2>

        <div class="setting">
            <label for="config-name">Configuration Name:</label>
            <input type="text" id="config-name" placeholder="e.g., Spanish Vocabulary">
        </div>

        <div class="setting">
            <input type="checkbox" id="skill-audio-only-checkbox">
            <label for="skill-audio-only-checkbox">Audio-Only Front (Listening Practice)</label>
        </div>

        <div class="setting">
          <label for="config-selector">Load Configuration:</label>
          <select id="config-selector"></select>
        </div>

        <div class="setting data-source-setting">
          <label for="data-url">Data Source URL (TSV/CSV):</label>
          <div class="input-with-button">
            <input type="text" id="data-url" value="https://docs.google.com/spreadsheets/d/e/2PACX-1vSW_KeHCyth3-9kWtpYHXl9aPVwoOhurjGINbJ4oNHWGoQMjSHyZl0J9LeraGDt51ZUjIsqrv9DXO27/pub?gid=2060234086&single=true&output=tsv">
            <button id="load-data">Load</button>
          </div>
        </div>

        <div class="tabs" role="tablist">
          <button class="tab-button active" id="basic-tab" data-tab="basic-settings" role="tab" aria-controls="basic-settings" aria-selected="true">Basic</button>
          <button class="tab-button" id="skills-tab" data-tab="skills-settings" role="tab" aria-controls="skills-settings" aria-selected="false">Skills</button>
          <button class="tab-button" id="advanced-tab" data-tab="advanced-settings" role="tab" aria-controls="advanced-settings" aria-selected="false">Advanced</button>
          <button class="tab-button" id="subset-tab" data-tab="subset-settings" role="tab" aria-controls="subset-settings" aria-selected="false">Subset</button>
          <button class="tab-button" id="dangerous-tab" data-tab="dangerous-settings" role="tab" aria-controls="dangerous-settings" aria-selected="false">Dangerous</button>
        </div>

        <div id="basic-settings" class="tab-panel active" role="tabpanel" aria-labelledby="basic-tab">
            <div class="setting" id="column-roles-container">
                 <!-- Master column role configuration will be generated here by JS -->
            </div>
            <div class="setting">
                <label for="font-selector">Font:</label>
                <select id="font-selector">
                    <option value="Arial">Arial</option>
                    <option value="Verdana">Verdana</option>
                    <option value="Times New Roman">Times New Roman</option>
                    <option value="Courier New">Courier New</option>
                </select>
            </div>
        </div>

        <div id="skills-settings" class="tab-panel" role="tabpanel" aria-labelledby="skills-tab">
            <div id="skills-list-container">
                <div class="skills-toolbar">
                    <button id="add-skill-button">Add New Skill</button>
                    <button id="preset-skills-button">Load Preset Skills</button>
                </div>
                <div id="skills-list">
                    <!-- User-defined skills will be dynamically added here -->
                </div>
            </div>
        </div>

        <div id="advanced-settings" class="tab-panel" role="tabpanel" aria-labelledby="advanced-tab">
            <div class="setting">
                <label for="tts-rate">Target Language Reading Speed:</label>
                <input type="range" id="tts-rate" min="0.1" max="2" value="1" step="0.1">
            </div>
            <div class="setting">
                <label for="tts-rate-base">Base Language Reading Speed:</label>
                <input type="range" id="tts-rate-base" min="0.1" max="3" value="1.5" step="0.1">
            </div>
            <div class="setting">
                <input type="checkbox" id="alternate-uppercase">
                <label for="alternate-uppercase">Alternate Uppercase on Front</label>
            </div>
            <div class="setting">
                <input type="checkbox" id="disable-animation">
                <label for="disable-animation">Disable Flip Animation</label>
            </div>
            <div class="setting">
                <input type="checkbox" id="audio-only-front">
                <label for="audio-only-front">Audio-Only Front</label>
            </div>
            <div class="setting">
                <input type="checkbox" id="tts-on-hotkey-only">
                <label for="tts-on-hotkey-only">Only read on hotkey (f)</label>
            </div>
            <div class="setting">
                <label for="repetition-intervals">Repetition Intervals (seconds, comma-separated):</label>
                <textarea id="repetition-intervals" rows="3"></textarea>
            </div>
        </div>

        <div id="subset-settings" class="tab-panel" role="tabpanel" aria-labelledby="subset-tab">
            <div class="setting">
                <label for="subset-config-name">New Subset Name:</label>
                <input type="text" id="subset-config-name" placeholder="e.g., Chapter 1 Words">
            </div>
            <div class="setting">
                <label for="subset-text">Source Text:</label>
                <textarea id="subset-text" rows="5" placeholder="Paste text here..."></textarea>
            </div>
            <button id="create-subset-config">Create and Load Subset</button>
        </div>

        <div id="dangerous-settings" class="tab-panel" role="tabpanel" aria-labelledby="dangerous-tab">
            <div class="setting">
                <p>This action cannot be undone.</p>
                <button id="reset-stats" class="danger">Reset Current Deck Stats</button>
            </div>
        </div>

        <div class="button-container">
            <button id="save-config" disabled>Save Configuration</button>
        </div>
        <div id="cache-status"></div>
      </div>
    </div>

    <div id="skill-config-modal" class="modal-overlay hidden">
        <div id="skill-config-panel">
            <button id="close-skill-config-button">X</button>
            <h3 id="skill-config-title">Configure Skill</h3>
            <input type="hidden" id="editing-skill-id">

            <div class="setting">
                <label for="skill-name-input">Skill Name:</label>
                <input type="text" id="skill-name-input" placeholder="e.g., French Reading">
            </div>

            <div class="setting">
                <input type="checkbox" id="skill-audio-only-checkbox">
                <label for="skill-audio-only-checkbox">Audio-Only Front (Listening Practice)</label>
            </div>

            <div class="setting">
                <label for="skill-verification-method">Verification Method:</label>
                <select id="skill-verification-method">
                    <option value="none">None (Self-Assessed)</option>
                    <option value="text">Text Input</option>
                    <option value="multiple-choice">Multiple Choice</option>
                </select>
            </div>

            <div class="setting-grid">
                <div><label>Front Column(s):</label></div>
                <div><label>Back Column(s):</label></div>
                <div id="skill-front-columns" class="column-checkbox-group"></div>
                <div id="skill-back-columns" class="column-checkbox-group"></div>
            </div>

            <div class="setting">
                <label for="skill-validation-column">Validation Column:</label>
                <select id="skill-validation-column" disabled>
                    <!-- Options will be populated by JS -->
                </select>
            </div>

            <div class="setting">
                <label for="skill-tts-front-column">TTS (Front) Column:</label>
                <select id="skill-tts-front-column">
                    <!-- Options will be populated by JS -->
                </select>
            </div>

            <div class="setting">
                <label for="skill-tts-back-column">TTS (Back) Column:</label>
                <select id="skill-tts-back-column">
                    <!-- Options will be populated by JS -->
                </select>
            </div>

            <div class="button-container">
                <button id="save-skill-button">Save Skill</button>
            </div>
        </div>
    </div>

    <div id="skill-selector-bar">
        <!-- Skill checkboxes will be populated here by JS -->
        <div id="skill-selector-checkboxes" class="column-checkbox-group"></div>
    </div>

    <div id="card-container">
      <div id="card">
        <div class="card-face card-front" id="card-front">
            <div class="tts-lang-display" id="tts-lang-display-front"></div>
            <div id="card-front-content"></div>
        </div>
        <div class="card-face card-back">
            <div class="tts-lang-display" id="tts-lang-display-back"></div>
            <div id="card-back-content"></div>
            <div id="comparison-container" class="hidden"></div>
        </div>
      </div>
      <div id="deck-title"></div>
      <div id="last-seen"></div>
      <div id="skill-mastery-dashboard"></div>
      <div id="writing-practice-container" class="hidden">
        <button id="slow-replay-button">üîä</button>
        <input type="text" id="writing-input" placeholder="Type the answer...">
        <button id="writing-submit">Submit</button>
      </div>
    </div>

    <div id="controls">
      <button id="prev-card"><span>‚¨ÖÔ∏è</span><span class="btn-text"> Prev (&larr;)</span></button>
      <button id="i-dont-know"><span>‚ùå</span><span class="btn-text"> I don't know (j)</span></button>
      <button id="flip-card"><span>üîÑ</span><span class="btn-text"> Flip (Space)</span></button>
      <button id="i-know"><span>‚úÖ</span><span class="btn-text"> I know this (k)</span></button>
      <button id="next-card"><span>‚û°Ô∏è</span><span class="btn-text"> Next (&rarr;)</span></button>
      <button id="slow-replay-hotkey"><span>üîÅ</span><span class="btn-text"> Replay (f)</span></button>
    </div>

    <div id="explanation-message"></div>
    <script src="https://cdn.jsdelivr.net/npm/diff/dist/diff.min.js"></script>
    <script type="module" src="app.js"></script>
  </body>
</html>
